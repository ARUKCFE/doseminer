---
title: R package doseminer
author: David Selby and Belay Birlie
output:
  github_document:
    df_print: kable
---

<!-- badges: start -->
<!-- badges: end -->

An R implementation of the [DOSES text mining algorithm of Karystianis et al.](http://gnteam.cs.manchester.ac.uk/resources/DOSES/) for extracting
drug dosage information from CPRD prescription data.
The aim of this project is to provide a complete replacement for the algorithm,
entirely written in R with no external dependencies (on Python on Java).
This should make the tool more portable, extensible and suitable for use across
different platforms (Windows, Mac, Unix).

## Roadmap

The package **doseminer** is still in development.
Current plans are to transliterate the existing Python code to R.
Later we will tidy up the user interface and possibly allow for customisation.

The bulk of the work will be in converting the `.mixup` files (see below) into the R equivalent. As it potentially avoids lots of file IO, it may ultimately be faster than the original implementation.

## Installation

The package is not yet available on CRAN, so install it from GitHub using
```r
# install.packages('remotes')
remotes::install_github('Selbosh/doseminer')
```

## Usage

The workhorse function is called `extract_from_prescription`.
Pass it a character vector of freetext prescriptions and it will try to extract
the following variables:

- Dose frequency (the number of times per day a dose is administered)
- Dose interval (the number of days between doses)
- Dose unit (how individual doses are measured, e.g. millilitres, tablets)
- Dose number (how many of those units comprise a single dose, e.g. 2 tablets)
- Optional (should the dose only be taken 'if required' / 'as needed'?)

```{r}
library(doseminer)
extract_from_prescription('take two and a half tablets every two to three days as needed')
```

Anything not matched is returned as `NA`, though some inferences are also made.
For instance: if a dosage is specified as multiple times per day, with no
explicit interval between days, it's inferred the interval is one day.
Similarly, if an interval is specified (e.g. every 3 days) but not a daily
frequency, it's presumed the dose is taken only once during the day.

To see the package in action, a small vector of example prescriptions is
included in the variable `example_prescriptions`.

```{r}
extract_from_prescription(example_prescriptions)
```

The column `output` represents the 'residual' text after other features have been extracted.
It can be ignored for most applications, but is useful for debugging prescriptions that have not been parsed as expected.

## Development notes

To do:

1. Unit tests
2. Formal benchmarking
3. Improving algorithmic accuracy (e.g. on half measures)

Built into this package is a series of functions for extracting and parsing
natural language English numbers into their digit-based numeric form. This
could be spun out into its own package for more general use.

```{r}
replace_numbers(c('Thirty seven bottles of beer on the wall',
                  'Take one down, pass it around',
                  'Thirty-six bottles of beer on the wall!',
                  'One MILLION dollars.',
                  'We do not take any half measures'))
```

Inspired by Ben Marwick's `words2number` (https://github.com/benmarwick/words2number).

## Contributors

Maintained by David Selby (`david.selby@manchester.ac.uk`), Belay Birlie and
(formerly) Katherine Dempsey.

## References

Karystianis, G., Sheppard, T., Dixon, W.G. *et al.*
Modelling and extraction of variability in free-text medication prescriptions from an anonymised primary care electronic medical record research database.
*BMC Med Inform Decis Mak* **16**, 18 (2015).  
https://doi.org/10.1186/s12911-016-0255-x
